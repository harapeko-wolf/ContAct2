# 1. 要件定義書

## 1.1. プロジェクト概要
本プロジェクトは、営業資料（PDF）をUUID付きリンクで顧客に届け、「いつ・誰が・何ページを・何秒見たか」を可視化し、検討状況を4択アンケートで確認、読了後に商談リンク（TimeRex）を表示することで、ホットリード抽出と自動営業アプローチを支援する新規ツール「ContAct2」を開発する。

## 1.2. プロジェクトの目的と背景
*   **目的**:
    *   営業プロセスの効率化: 営業担当者が顧客の資料閲覧状況を把握し、関心の高いリードに集中できるようにする。
    *   商談化率の向上: 顧客の検討度合いに応じた適切なタイミングで商談機会を創出する。
    *   自動化による工数削減: 資料送付から初期アプローチまでの一部を自動化する。
*   **背景**:
    *   従来の営業手法では、送付した資料が実際に読まれているか、顧客がどの程度関心を持っているかを把握することが困難であった。
    *   関心度の低い顧客へのアプローチに時間を浪費し、有望なリードを見逃す可能性があった。

## 1.3. ターゲットユーザー
*   **営業担当者**: 本ツールの管理者および利用者。資料のアップロード、共有リンクの発行、顧客の閲覧状況・アンケート結果の確認、TimeRexとの連携設定を行う。
*   **顧客**: 営業担当者から共有されたリンクを通じてPDF資料を閲覧し、任意でアンケートに回答、商談予約を行う。

## 1.4. 機能要件
### 1.4.1. フェーズ1（コア機能 - `frontend/` のUIに基づくもの）
*   **F-001: ユーザー認証機能（営業担当者向け）**
    *   ログイン、ログアウト機能。
*   **F-002: 会社管理機能**
    *   営業担当者が所属する会社情報の登録・管理。（複数社利用を想定する場合はテナント管理が必要）
*   **F-003: 資料（PDF）管理機能**
    *   PDFファイルのアップロード、一覧表示、詳細表示、編集、削除。
*   **F-004: 資料共有リンク生成機能**
    *   アップロードされたPDFごとに、UUIDを含む一意の共有リンクを生成。
*   **F-005: 資料閲覧機能（顧客向け）**
    *   共有リンクからPDFをブラウザ上で閲覧できる。
*   **F-006: 資料閲覧状況トラッキング機能**
    *   「いつ（日時）」「誰が（※顧客特定方法は要検討）」「どのページを」「何秒間見たか」を記録。
    *   顧客の特定方法：初期アクセス時に簡易な情報（例：メールアドレス、または匿名セッションID）を取得するか検討。
*   **F-007: 4択アンケート機能**
    *   PDF閲覧後（または特定ページ到達後）に表示される、予め設定された4択アンケート。
    *   アンケート内容の設定機能（営業担当者向け）。
    *   アンケート回答の記録。
*   **F-008: 商談リンク表示機能（TimeRex連携）**
    *   アンケート回答後（またはPDF読了後）に、予め設定されたTimeRexの予約ページへのリンクを表示。
*   **F-009: 閲覧状況・アンケート結果表示機能**
    *   営業担当者が、資料ごと・顧客ごとの閲覧状況やアンケート結果を確認できるダッシュボード機能。

### 1.4.2. フェーズ1以降検討機能
*   **F-010: ホットリード抽出・通知機能**
    *   閲覧状況（例：特定ページ熟読、読了率高）やアンケート結果に基づき、関心が高いと判断される顧客を自動で抽出し、営業担当者に通知する。
*   **F-011: 自動フォローアップメール送信機能**
    *   PDFを最後まで閲覧したが商談予約に至らなかった顧客に対し、一定時間後（例：30分後）に自動で予約を促すメールを送信する。

## 1.5. 非機能要件
*   **NF-001: パフォーマンス**
    *   PDF表示のレスポンス時間：一般的なWebサービスレベル（例：初回表示3秒以内）。
    *   同時アクセス数：初期は少数ユーザーを想定。将来的なスケールアップを考慮した設計。
*   **NF-002: セキュリティ**
    *   PDFファイルへの不正アクセス防止（UUIDリンク、必要に応じて署名付きURL等）。
    *   営業担当者の認証情報の安全な管理。
    *   データベースへの不正アクセス防止。
    *   **PDFストレージ**: `/frontend/public/` は開発用の一時配置とし、本番環境ではセキュリティとスケーラビリティに優れたクラウドストレージ（AWS S3等）を推奨。
*   **NF-003: 可用性・信頼性**
    *   **稼働時間**: 一般的なWebサービスレベル。過度なSLAは初期フェーズでは設けない。
    *   **バックアップ**: データベース、PDFファイルは定期的なバックアップを実施。具体的な頻度・復旧時間は別途定義（例：DB日次バックアップ、PDFはストレージサービスの冗長性に依存）。
*   **NF-004: 運用・保守性**
    *   **監視**: アプリケーションエラー（Sentry等）、サーバーリソースの基本的な監視。
    *   **ログ収集**: アクセスログ、エラーログの収集。

## 1.6. 統合要件
*   **I-001: TimeRex連携**
    *   営業担当者が設定したTimeRexの予約ページへ顧客を誘導する。
    *   TimeRexのWebhookを利用し、予約完了イベントを本システムで補足し、ステータスを更新する。（TimeRexのWebhook仕様に基づく）
    *   *懸念事項*: TimeRex側で予約完了後の任意リダイレクトが不可の場合、Webhookへの依存度が高まる。

## 1.7. システム構成案（初期）
*   フロントエンド: Next.js 15 （既存）
*   バックエンド: Laravel 12 （既存）
*   データベース: MySQL 8.4 （既存）
*   PDFストレージ: クラウドストレージ（AWS S3, Google Cloud Storage, Azure Blob Storage等）
*   メール送信: 外部メール配信サービス（SendGrid, Amazon SES等）
*   エラー監視: Sentry 