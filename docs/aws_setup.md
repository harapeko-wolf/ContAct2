# AWSセットアップ手順

## 1. AWSアカウントの作成

### 1.1 アカウント作成手順
1. [AWS公式サイト](https://aws.amazon.com/jp/)にアクセス
2. 「アカウントを作成」をクリック
3. メールアドレス、パスワード、アカウント名を入力
4. クレジットカード情報の入力
5. 本人確認（電話番号認証）

### 1.2 初期設定
1. 請求アラートの設定
   - 予算アラートの設定（$50/月）
   - 使用量アラートの設定
2. マルチファクタ認証の有効化
3. ルートユーザーのアクセスキーを無効化

## 2. IAMユーザーの作成

### 2.1 管理者ユーザーの作成
1. IAMコンソールにアクセス
2. 「ユーザー」→「ユーザーを作成」
3. ユーザー名を入力（例：`admin-user`）
4. アクセスキーの作成
5. 管理者ポリシーのアタッチ（`AdministratorAccess`）

### 2.2 アクセスキーの保存
- アクセスキーID
- シークレットアクセスキー
を安全な場所に保存

## 3. VPCの作成

### 3.1 基本設定
1. VPCコンソールにアクセス
2. 「VPCを作成」をクリック
3. 以下の設定を入力：
   - 名前タグ：`contact2-vpc`
   - IPv4 CIDR：`10.0.0.0/16`
   - テナンシー：デフォルト

### 3.2 サブネットの作成
1. パブリックサブネット
   - 名前：`contact2-public-1`
   - AZ：`ap-northeast-1a`
   - CIDR：`10.0.1.0/24`

2. プライベートサブネット
   - 名前：`contact2-private-1`
   - AZ：`ap-northeast-1a`
   - CIDR：`10.0.2.0/24`

### 3.3 インターネットゲートウェイ
1. IGWの作成
2. VPCへのアタッチ
3. ルートテーブルの設定

## 4. セキュリティグループの作成

### 4.1 ALB用セキュリティグループ
- 名前：`contact2-alb-sg`
- インバウンドルール：
  - HTTP (80)
  - HTTPS (443)

### 4.2 ECS用セキュリティグループ
- 名前：`contact2-ecs-sg`
- インバウンドルール：
  - ALBからのHTTP (80)

### 4.3 RDS用セキュリティグループ
- 名前：`contact2-rds-sg`
- インバウンドルール：
  - ECSからのMySQL (3306)

## 5. S3バケットの作成

### 5.1 バケットの作成
1. S3コンソールにアクセス
2. 「バケットを作成」をクリック
3. 以下の設定を入力：
   - バケット名：`contact2-documents`
   - リージョン：`ap-northeast-1`
   - パブリックアクセスをブロック
   - バージョニングを有効化

### 5.2 バケットポリシーの設定
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowECSAccess",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::<ACCOUNT_ID>:role/contact2-ecs-task-role"
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject"
            ],
            "Resource": "arn:aws:s3:::contact2-documents/*"
        }
    ]
}
```

## 6. RDSの作成

### 6.1 インスタンスの作成
1. RDSコンソールにアクセス
2. 「データベースの作成」をクリック
3. 以下の設定を入力：
   - エンジンタイプ：MySQL
   - バージョン：8.0
   - テンプレート：本番環境
   - インスタンスクラス：db.t3.small
   - ストレージ：20GB
   - マルチAZ配置：はい
   - VPC：contact2-vpc
   - サブネットグループ：contact2-db-subnet-group
   - セキュリティグループ：contact2-rds-sg

### 6.2 パラメータグループの設定
- 文字セット：utf8mb4
- 照合順序：utf8mb4_unicode_ci

## 7. ECSクラスターの作成

### 7.1 クラスターの作成
1. ECSコンソールにアクセス
2. 「クラスターの作成」をクリック
3. 以下の設定を入力：
   - クラスター名：`contact2-cluster`
   - インフラストラクチャ：AWS Fargate

### 7.2 タスク定義の作成
1. 「タスク定義の作成」をクリック
2. 以下の設定を入力：
   - タスク定義名：`contact2-task`
   - コンテナ定義：
     - 名前：`contact2-app`
     - イメージ：`<ECR_REPOSITORY_URL>:latest`
     - ポートマッピング：80
     - 環境変数の設定

## 8. CloudFrontの設定

### 8.1 ディストリビューションの作成
1. CloudFrontコンソールにアクセス
2. 「ディストリビューションの作成」をクリック
3. 以下の設定を入力：
   - オリジンドメイン：ALBのDNS名
   - ビューワープロトコルポリシー：Redirect HTTP to HTTPS
   - キャッシュポリシー：CachingOptimized

### 8.2 カスタムドメインの設定
1. ACM証明書の取得
2. カスタムドメインの追加
3. DNSレコードの設定

## 9. Route 53の設定

### 9.1 ホストゾーンの作成
1. Route 53コンソールにアクセス
2. 「ホストゾーンの作成」をクリック
3. ドメイン名を入力

### 9.2 レコードの作成
1. Aレコードの作成
   - 名前：`api`
   - タイプ：A
   - エイリアス：CloudFrontディストリビューション

## 10. 監視の設定

### 10.1 CloudWatchの設定
1. ダッシュボードの作成
2. メトリクスの追加
3. アラームの設定

### 10.2 ログの設定
1. ロググループの作成
2. ログストリームの設定
3. 保持期間の設定

## 11. デプロイメントの設定

### 11.1 ECRリポジトリの作成
1. ECRコンソールにアクセス
2. 「リポジトリの作成」をクリック
3. リポジトリ名を入力：`contact2-app`

### 11.2 GitHub Actionsの設定
1. シークレットの設定
   - `AWS_ACCESS_KEY_ID`
   - `AWS_SECRET_ACCESS_KEY`
   - `AWS_REGION`
2. ワークフローファイルの作成

## 12. 動作確認

### 12.1 アプリケーションのデプロイ
1. イメージのプッシュ
2. タスクの更新
3. サービスの更新

### 12.2 動作確認項目
1. アプリケーションへのアクセス
2. データベース接続
3. S3へのファイルアップロード
4. ログの確認
5. メトリクスの確認 